<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <link rel=stylesheet href="../../code.css" type="text/css"></head><body><pre><span class='linenumber'>   1</span> <span class="COMM">/*
<span class='linenumber'>   2</span>    Copyright (c) 2012 KT Corp.
<span class='linenumber'>   3</span>   
<span class='linenumber'>   4</span>    This program is free software: you can redistribute it and/or modify
<span class='linenumber'>   5</span>    it under the terms of the GNU Lesser General Public License as published by
<span class='linenumber'>   6</span>    the Free Software Foundation, either version 3 of the License, or
<span class='linenumber'>   7</span>    (at your option) any later version.
<span class='linenumber'>   8</span> 
<span class='linenumber'>   9</span>    This program is distributed in the hope that it will be useful,
<span class='linenumber'>  10</span>    but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class='linenumber'>  11</span>    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class='linenumber'>  12</span>    GNU Lesser General Public License for more details.
<span class='linenumber'>  13</span> 
<span class='linenumber'>  14</span>    You should have received a copy of the GNU Lesser General Public License
<span class='linenumber'>  15</span>    along with This program.  If not, see &lt;http://www.gnu.org/licenses/>.
<span class='linenumber'>  16</span> */</span><span class="WHIT">
<span class='linenumber'>  17</span> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">global</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  18</span> 
<span class='linenumber'>  19</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  20</span>        * Request option context maker.
<span class='linenumber'>  21</span>        * @private
<span class='linenumber'>  22</span>        * @param {Object} opts Request options
<span class='linenumber'>  23</span>        * @returns {Object} Request context
<span class='linenumber'>  24</span>        */</span><span class="WHIT">
<span class='linenumber'>  25</span> </span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_createRequestOpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  26</span> </span><span class="WHIT">        </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  27</span> </span><span class="WHIT">          </span><span class="COMM">// Default Request Options</span><span class="WHIT">
<span class='linenumber'>  28</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'GET'</span><span class="PUNC">,</span><span class="WHIT">              </span><span class="COMM">// 'GET', 'POST', 'JSONP'</span><span class="WHIT">
<span class='linenumber'>  29</span> </span><span class="WHIT">          </span><span class="NAME">contentType</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'application/x-www-form-urlencoded'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  30</span> </span><span class="WHIT">          </span><span class="NAME">encoding</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'UTF-8'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  31</span> </span><span class="WHIT">          </span><span class="NAME">async</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  32</span> </span><span class="WHIT">          </span><span class="NAME">timeout</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5000</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="COMM">// Default timeout is 5 seconds</span><span class="WHIT">
<span class='linenumber'>  33</span> </span><span class="WHIT">          </span><span class="NAME">silent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="COMM">// Does not fire system events</span><span class="WHIT">
<span class='linenumber'>  34</span> </span><span class="WHIT">          </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">                   </span><span class="COMM">// URL used to send the request</span><span class="WHIT">
<span class='linenumber'>  35</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} params Parameters used by POST request */</span><span class="WHIT">
<span class='linenumber'>  36</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} username User name for an authentication */</span><span class="WHIT">
<span class='linenumber'>  37</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} password Password for an authentication */</span><span class="WHIT">
<span class='linenumber'>  38</span> </span><span class="WHIT">          </span><span class="COMM">/** @param {String} callbackParam JSONP callback param key */</span><span class="WHIT">
<span class='linenumber'>  39</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  40</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  41</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  42</span> 
<span class='linenumber'>  43</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  44</span>        * Creates equest timeout handler.
<span class='linenumber'>  45</span>        * &lt;p/>
<span class='linenumber'>  46</span>        * Timeout callback handled via request ctx.responseProxy.
<span class='linenumber'>  47</span>        * @private
<span class='linenumber'>  48</span>        * @param {Object} ctx Request context
<span class='linenumber'>  49</span>        * @returns {Number} Timer id if the timeout was set, undefined otherwise
<span class='linenumber'>  50</span>        */</span><span class="WHIT">
<span class='linenumber'>  51</span> </span><span class="WHIT">      </span><span class="NAME">_createTimeout</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  52</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeout</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  53</span> </span><span class="WHIT">          </span><span class="COMM">/** Request timed out, notify callback handler 
<span class='linenumber'>  54</span>            * @inner */</span><span class="WHIT">
<span class='linenumber'>  55</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  56</span> </span><span class="WHIT">            </span><span class="COMM">// Timeout Error call by passing in an error response</span><span class="WHIT">
<span class='linenumber'>  57</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.responseProxy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  58</span> </span><span class="WHIT">              </span><span class="NAME">ctx.responseProxy</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">408</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Client Request Timeout'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  59</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  60</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.timeout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  61</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  62</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  63</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  64</span> 
<span class='linenumber'>  65</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  66</span>        * Notifies a runtime system event.
<span class='linenumber'>  67</span>        * @private
<span class='linenumber'>  68</span>        * @param {Object} ctx Request context
<span class='linenumber'>  69</span>        * @param {String} eventName Event name
<span class='linenumber'>  70</span>        */</span><span class="WHIT">
<span class='linenumber'>  71</span> </span><span class="WHIT">      </span><span class="NAME">_fireSysEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  72</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ctx.silent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  73</span> </span><span class="WHIT">          </span><span class="NAME">tau.getRuntime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fireEvent</span><span class="PUNC">(</span><span class="NAME">eventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  74</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  75</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>  76</span> 
<span class='linenumber'>  77</span> </span><span class="WHIT">      </span><span class="COMM">/**
<span class='linenumber'>  78</span>        * @class
<span class='linenumber'>  79</span>        * A response corresponding to a XML/XSS/Proxy request.
<span class='linenumber'>  80</span>        * @constructs
<span class='linenumber'>  81</span>        * @private
<span class='linenumber'>  82</span>        * @param {Number} status Request status
<span class='linenumber'>  83</span>        * @param {String} statusText Status in string
<span class='linenumber'>  84</span>        * @param {String} contType Content type (e.g. html/text)
<span class='linenumber'>  85</span>        * @param {String} respText Content in text
<span class='linenumber'>  86</span>        * @param {String} respXML Content in XML
<span class='linenumber'>  87</span>        */</span><span class="WHIT">
<span class='linenumber'>  88</span> </span><span class="WHIT">      </span><span class="NAME">_Response</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">statusText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contType</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">respText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">respXML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  89</span> </span><span class="WHIT">        </span><span class="NAME">this.status</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">status</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  90</span> </span><span class="WHIT">        </span><span class="NAME">this.statusText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">statusText</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  91</span> </span><span class="WHIT">        </span><span class="NAME">this.contentType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">contType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  92</span> </span><span class="WHIT">        </span><span class="NAME">this.responseText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">respText</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  93</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contType</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">contType.indexOf</span><span class="PUNC">(</span><span class="STRN">'application/json'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  94</span> </span><span class="WHIT">          </span><span class="NAME">this.responseJSON</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">respText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">tau.parse</span><span class="PUNC">(</span><span class="NAME">respText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">respText</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  95</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  96</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">respXML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>  97</span> </span><span class="WHIT">            </span><span class="NAME">respXML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parseFromString</span><span class="PUNC">(</span><span class="NAME">respText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>  98</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>  99</span> </span><span class="WHIT">          </span><span class="NAME">this.responseXML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">respXML</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 100</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 101</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 102</span> 
<span class='linenumber'> 103</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.XMLRequest.prototype */</span><span class="WHIT">
<span class='linenumber'> 104</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.XMLRequest'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 105</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 106</span>      * 명시된 옵션들을 이용하여 새로운 객체를 생성한다.
<span class='linenumber'> 107</span>      * Request 처리에 따라 다음과 같은 시스템 이벤트가
<span class='linenumber'> 108</span>      * 발생된다.&lt;p/>
<span class='linenumber'> 109</span>      * {@link tau.rt.Event.REQ_SENT}: Request가 전송되었을
<span class='linenumber'> 110</span>      * 때&lt;br/>
<span class='linenumber'> 111</span>      * {@link tau.rt.Event.REQ_RECEIVED}: Response를 받았을
<span class='linenumber'> 112</span>      * 때&lt;br/>
<span class='linenumber'> 113</span>      * {@link tau.rt.Event.REQ_ABORTED}: Request가 중지되었을
<span class='linenumber'> 114</span>      * 때&lt;p/>
<span class='linenumber'> 115</span>      * 시스템 이벤트를 받기 위해서는 다음과 같이 Runtime에
<span class='linenumber'> 116</span>      * 이벤트 리스너를 달아야 한다.
<span class='linenumber'> 117</span>      * @example
<span class='linenumber'> 118</span>      * var rt = tau.getRuntime();
<span class='linenumber'> 119</span>      * rt.onEvent(tau.rt.Event.REQ_SENT, function (e, payload) {
<span class='linenumber'> 120</span>      *   ...
<span class='linenumber'> 121</span>      * });
<span class='linenumber'> 122</span>      *
<span class='linenumber'> 123</span>      * @class
<span class='linenumber'> 124</span>      * XMLHttpRequest Helper클래스
<span class='linenumber'> 125</span>      * @constructs
<span class='linenumber'> 126</span>      * @param {Object} [opts] XMLHttpRequest 요청에 필요한
<span class='linenumber'> 127</span>      * 옵션들 
<span class='linenumber'> 128</span>      * @param {String} [opts.type = 'GET'] Request 방식(GET,
<span class='linenumber'> 129</span>      * POST중 택일)
<span class='linenumber'> 130</span>      * @param {String} [opts.contentType = 'application/x-www-form-urlencoded'] 콘텐츠 인코딩 방식
<span class='linenumber'> 131</span>      * @param {String} [opts.encoding = 'UTF-8'] 인코딩 방식
<span class='linenumber'> 132</span>      * @param {Boolean} [opts.async = true] Sync or
<span class='linenumber'> 133</span>      * Async전송방식 결정
<span class='linenumber'> 134</span>      * @param {Number} [opts.timeout = 5000] Request 최대
<span class='linenumber'> 135</span>      * Timeout시간 (milliseconds)
<span class='linenumber'> 136</span>      * @param {Boolean} [opts.silent = false] 시스템 이벤트
<span class='linenumber'> 137</span>      * 발생 여부
<span class='linenumber'> 138</span>      * @param {String} [opts.url] Request를 전송하기 위한 URL
<span class='linenumber'> 139</span>      * @see tau.data.XSSRequest
<span class='linenumber'> 140</span>      */</span><span class="WHIT">
<span class='linenumber'> 141</span> </span><span class="WHIT">    </span><span class="NAME">XMLRequest</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 142</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Default options */</span><span class="WHIT">
<span class='linenumber'> 143</span> </span><span class="WHIT">      </span><span class="NAME">this._opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createRequestOpts</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 144</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Maps request id to per XMLRequest instance */</span><span class="WHIT">
<span class='linenumber'> 145</span> </span><span class="WHIT">      </span><span class="NAME">this._registry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 146</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 147</span> 
<span class='linenumber'> 148</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 149</span>      * XMLHttpRequest를 이용하여 Request를 전송한다.
<span class='linenumber'> 150</span>      * @param {String} url Request를 전송할 URL
<span class='linenumber'> 151</span>      * @param {Function} callbackFn Request전송후 응답(success/fail)이
<span class='linenumber'> 152</span>      * 왔을 때의 callback함수
<span class='linenumber'> 153</span>      * @param {Object} opts 생성자에서 정의한 옵션들을
<span class='linenumber'> 154</span>      * Override할 수 있다.
<span class='linenumber'> 155</span>      * @returns {String} Request id
<span class='linenumber'> 156</span>      */</span><span class="WHIT">
<span class='linenumber'> 157</span> </span><span class="WHIT">    </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 158</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 159</span> </span><span class="WHIT">          </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 160</span> </span><span class="WHIT">        </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.genId</span><span class="PUNC">(</span><span class="STRN">'xml'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 161</span> </span><span class="WHIT">        </span><span class="NAME">req</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 162</span> </span><span class="WHIT">        </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 163</span> </span><span class="WHIT">        </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 164</span> </span><span class="WHIT">        </span><span class="NAME">callbackFn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">callbackFn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 165</span> 
<span class='linenumber'> 166</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 167</span>          * Handles both XHR state changes and native response errors.
<span class='linenumber'> 168</span>          * (will be assigned to XMLHttpRequest.XHR.onreadystatechange)
<span class='linenumber'> 169</span>          * &lt;p/>
<span class='linenumber'> 170</span>          * Note: client-aborted requests must not be handled here because 
<span class='linenumber'> 171</span>          * aborted request must not call the &lt;code>callbackFn&lt;/code>.
<span class='linenumber'> 172</span>          * @inner
<span class='linenumber'> 173</span>          * @param {Object} event XHR request or error Response
<span class='linenumber'> 174</span>          */</span><span class="WHIT">
<span class='linenumber'> 175</span> </span><span class="WHIT">        </span><span class="NAME">responseProxy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 176</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 177</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.req</span><span class="WHIT"> 
<span class='linenumber'> 178</span>               </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.req.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 179</span> </span><span class="WHIT">            </span><span class="NAME">ctx.req.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Avoid timeout race condition </span><span class="WHIT">
<span class='linenumber'> 180</span> 
<span class='linenumber'> 181</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">event</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 182</span> </span><span class="WHIT">              </span><span class="COMM">// Error initiated by the client: abort XHR</span><span class="WHIT">
<span class='linenumber'> 183</span> </span><span class="WHIT">              </span><span class="NAME">ctx.req.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 184</span> </span><span class="WHIT">              </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 185</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 186</span> </span><span class="WHIT">              </span><span class="COMM">// Successfully received response via XHR (status: 200 - 299)</span><span class="WHIT">
<span class='linenumber'> 187</span> </span><span class="WHIT">              </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NAME">ctx.req.status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.statusText</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='linenumber'> 188</span>                             </span><span class="NAME">ctx.req.getResponseHeader</span><span class="PUNC">(</span><span class="STRN">'Content-Type'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='linenumber'> 189</span>                             </span><span class="NAME">ctx.req.responseText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.responseXML</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 190</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 191</span> </span><span class="WHIT">            </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'status: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">resp.statusText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">that</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 192</span> 
<span class='linenumber'> 193</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.callbackFn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 194</span> </span><span class="WHIT">              </span><span class="NAME">ctx.callbackFn</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// Client callback with native response</span><span class="WHIT">
<span class='linenumber'> 195</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 196</span> 
<span class='linenumber'> 197</span> </span><span class="WHIT">            </span><span class="NAME">ctx.release</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 198</span> </span><span class="WHIT">            </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_RECEIVED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 199</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 200</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 201</span> 
<span class='linenumber'> 202</span> </span><span class="WHIT">        </span><span class="COMM">/** Releases all of the request resource for this closure. 
<span class='linenumber'> 203</span>          * @inner */</span><span class="WHIT">
<span class='linenumber'> 204</span> </span><span class="WHIT">        </span><span class="NAME">release</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 205</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 206</span> </span><span class="WHIT">            </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 207</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 208</span> </span><span class="WHIT">          </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">that._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 209</span> </span><span class="WHIT">          </span><span class="NAME">ctx.req</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Prevent closure memory leak on onreadystatechange</span><span class="WHIT">
<span class='linenumber'> 210</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 211</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._opts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 212</span> </span><span class="WHIT">      </span><span class="NAME">ctx.req.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.responseProxy</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 213</span> 
<span class='linenumber'> 214</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 215</span> </span><span class="WHIT">        </span><span class="NAME">this._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Async request registration</span><span class="WHIT">
<span class='linenumber'> 216</span> </span><span class="WHIT">        </span><span class="NAME">ctx.timeoutId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createTimeout</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 217</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 218</span> 
<span class='linenumber'> 219</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.URL.indexOf</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 220</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">'Under original scheme of \''</span><span class="WHIT">
<span class='linenumber'> 221</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.URL.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">document.URL.indexOf</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'> 222</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'\' your request can not be handled as XHR: '</span><span class="WHIT">
<span class='linenumber'> 223</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.currentStack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 224</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 225</span> </span><span class="WHIT">      </span><span class="COMM">// Send XHR request</span><span class="WHIT">
<span class='linenumber'> 226</span> </span><span class="WHIT">      </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 227</span> </span><span class="WHIT">        </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_SENT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 228</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.url.indexOf</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> 
<span class='linenumber'> 229</span>             </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ctx.url.indexOf</span><span class="PUNC">(</span><span class="STRN">'http://'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">document.domain</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 230</span> </span><span class="WHIT">          </span><span class="NAME">ctx.referer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.url</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// tunnel proxy</span><span class="WHIT">
<span class='linenumber'> 231</span> </span><span class="WHIT">          </span><span class="NAME">ctx.url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'./proxy'</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 232</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 233</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.open</span><span class="PUNC">(</span><span class="NAME">ctx.type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.async</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.username</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.password</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 234</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.referer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 235</span> </span><span class="WHIT">          </span><span class="NAME">ctx.req.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">'x-tau-uri'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.referer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 236</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 237</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">'Content-type'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.contentType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 238</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.send</span><span class="PUNC">(</span><span class="NAME">ctx.type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'GET'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> 
<span class='linenumber'> 239</span>             </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.url</span><span class="PUNC">(</span><span class="NAME">ctx.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.params</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">query</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 240</span> 
<span class='linenumber'> 241</span> </span><span class="WHIT">        </span><span class="COMM">// Synchronous response can do callback immediately after</span><span class="WHIT">
<span class='linenumber'> 242</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ctx.async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 243</span> </span><span class="WHIT">          </span><span class="NAME">ctx.callbackFn</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NAME">ctx.req.status</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.statusText</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='linenumber'> 244</span>                           </span><span class="NAME">ctx.req.getResponseHeader</span><span class="PUNC">(</span><span class="STRN">'Content-Type'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='linenumber'> 245</span>                           </span><span class="NAME">ctx.req.responseText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.req.responseXML</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 246</span> </span><span class="WHIT">          </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_RECEIVED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 247</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 248</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 249</span> </span><span class="WHIT">        </span><span class="COMM">// Notify error to client (request abort done in responseProxy)</span><span class="WHIT">
<span class='linenumber'> 250</span> </span><span class="WHIT">        </span><span class="NAME">ctx.responseProxy</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">400</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ex.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ex.code</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'): '</span><span class="WHIT"> 
<span class='linenumber'> 251</span>             </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ex.message</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 252</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 253</span> 
<span class='linenumber'> 254</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 255</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 256</span> 
<span class='linenumber'> 257</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 258</span>      * 명시된 id를 이용하여 이전에 전송했던 Request를 중지시킨다. 내부적으로
<span class='linenumber'> 259</span>      * {@link tau.rt.Event.REQ_ABORTED}이벤트가 발생된다.
<span class='linenumber'> 260</span>      * @param {String} id Request id
<span class='linenumber'> 261</span>      */</span><span class="WHIT">
<span class='linenumber'> 262</span> </span><span class="WHIT">    </span><span class="NAME">abort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 263</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._registry</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 264</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 265</span> </span><span class="WHIT">        </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'aborted ('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 266</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Avoid timeout race condition</span><span class="WHIT">
<span class='linenumber'> 267</span> </span><span class="WHIT">        </span><span class="NAME">ctx.req.abort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 268</span> </span><span class="WHIT">        </span><span class="NAME">ctx.release</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 269</span> </span><span class="WHIT">        </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_ABORTED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 270</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 271</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 272</span> 
<span class='linenumber'> 273</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 274</span>      * XMLHttpRequest는 Garbage Collection을 수행하지 않는다.(empty function)
<span class='linenumber'> 275</span>      * @function
<span class='linenumber'> 276</span>      */</span><span class="WHIT">
<span class='linenumber'> 277</span> </span><span class="WHIT">    </span><span class="NAME">gc</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.emptyFn</span><span class="WHIT">
<span class='linenumber'> 278</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 279</span> 
<span class='linenumber'> 280</span> 
<span class='linenumber'> 281</span> </span><span class="WHIT">  </span><span class="COMM">/** @lends tau.data.XSSRequest.prototype */</span><span class="WHIT">
<span class='linenumber'> 282</span> </span><span class="WHIT">  </span><span class="NAME">$class</span><span class="PUNC">(</span><span class="STRN">'tau.data.XSSRequest'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">define</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 283</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 284</span>      * 명시된 옵션을 이용하여 새로운 객체를 생성한다.
<span class='linenumber'> 285</span>      * Request 처리에 따라 다음과 같은 시스템 이벤트가
<span class='linenumber'> 286</span>      * 발생된다.&lt;p/>
<span class='linenumber'> 287</span>      * {@link tau.rt.Event.REQ_SENT}: Request가 전송되었을
<span class='linenumber'> 288</span>      * 때&lt;br/>
<span class='linenumber'> 289</span>      * {@link tau.rt.Event.REQ_RECEIVED}: Response를 받았을
<span class='linenumber'> 290</span>      * 때&lt;br/>
<span class='linenumber'> 291</span>      * {@link tau.rt.Event.REQ_ABORTED}: Request가 중지되었을
<span class='linenumber'> 292</span>      * 때&lt;p/>
<span class='linenumber'> 293</span>      * 시스템 이벤트를 받기 위해서는 다음과 같이 Runtime에
<span class='linenumber'> 294</span>      * 이벤트 리스너를 달아야 한다.
<span class='linenumber'> 295</span>      * @example
<span class='linenumber'> 296</span>      * var rt = tau.getRuntime();
<span class='linenumber'> 297</span>      * rt.onEvent(tau.rt.Event.REQ_SENT, function (e, payload) {
<span class='linenumber'> 298</span>      *   ...
<span class='linenumber'> 299</span>      * });
<span class='linenumber'> 300</span>      * @class
<span class='linenumber'> 301</span>      * Cross Script loading request helper.
<span class='linenumber'> 302</span>      * @constructs
<span class='linenumber'> 303</span>      * @param {Object} [opts] XSSRequest 요청에 필요한
<span class='linenumber'> 304</span>      * 옵션들 
<span class='linenumber'> 305</span>      * @param {String} [opts.type = 'JSONP'] Request 방식
<span class='linenumber'> 306</span>      * @param {String} [opts.contentType = 'application/json'] 콘텐츠 인코딩 방식
<span class='linenumber'> 307</span>      * @param {String} [opts.encoding = 'UTF-8'] 인코딩 방식
<span class='linenumber'> 308</span>      * @param {Number} [opts.timeout = 5000] Request 최대
<span class='linenumber'> 309</span>      * Timeout시간 (milliseconds)
<span class='linenumber'> 310</span>      * @param {Boolean} [opts.silent = false] 시스템 이벤트
<span class='linenumber'> 311</span>      * 발생 여부
<span class='linenumber'> 312</span>      * @param {Boolean} [opts.jsonpCallback = 'callback']
<span class='linenumber'> 313</span>      * Callback함수를 지정하기 위한 키
<span class='linenumber'> 314</span>      * @param {String} [opts.url] Request를 전송하기 위한 URL
<span class='linenumber'> 315</span>      * @see tau.data.XMLRequest
<span class='linenumber'> 316</span>      */</span><span class="WHIT">
<span class='linenumber'> 317</span> </span><span class="WHIT">    </span><span class="NAME">XSSRequest</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 318</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Default options */</span><span class="WHIT">
<span class='linenumber'> 319</span> </span><span class="WHIT">      </span><span class="NAME">this._opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createRequestOpts</span><span class="PUNC">(</span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 320</span> </span><span class="WHIT">      </span><span class="COMM">// JSONP namespace Must be globally accessible</span><span class="WHIT">
<span class='linenumber'> 321</span> </span><span class="WHIT">      </span><span class="NAME">this._opts.jsonpNamespace</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._opts.jsonpNamespace</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.$classname</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 322</span> </span><span class="WHIT">      </span><span class="COMM">/** @private Maps request id to request per JSONP namespace */</span><span class="WHIT">
<span class='linenumber'> 323</span> </span><span class="WHIT">      </span><span class="NAME">this._registry</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$class.forName</span><span class="PUNC">(</span><span class="NAME">this._opts.jsonpNamespace</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 324</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 325</span> 
<span class='linenumber'> 326</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 327</span>      * 동적 스크립트 로딩 방식으로 Requet를 전송한다.
<span class='linenumber'> 328</span>      * XSSRequest는 항상 Async 방식으로 통신한다.
<span class='linenumber'> 329</span>      * @param {String} url Request를 전송할 URL
<span class='linenumber'> 330</span>      * @param {Function} callbackFn Request전송후 응답(success/fail)이
<span class='linenumber'> 331</span>      * 왔을 때의 callback함수
<span class='linenumber'> 332</span>      * @param {Object} opts 생성자에서 정의한 옵션들을
<span class='linenumber'> 333</span>      * Override할 수 있다.
<span class='linenumber'> 334</span>      * @returns {String} Request id
<span class='linenumber'> 335</span>      */</span><span class="WHIT">
<span class='linenumber'> 336</span> </span><span class="WHIT">    </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 337</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 338</span> </span><span class="WHIT">          </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 339</span> </span><span class="WHIT">        </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.genId</span><span class="PUNC">(</span><span class="STRN">'xss'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 340</span> </span><span class="WHIT">        </span><span class="NAME">req</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tau.ScriptHelper</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 341</span> </span><span class="WHIT">        </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 342</span> </span><span class="WHIT">        </span><span class="NAME">url</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 343</span> </span><span class="WHIT">        </span><span class="NAME">callbackFn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">callbackFn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">callbackFn</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 344</span> 
<span class='linenumber'> 345</span> </span><span class="WHIT">        </span><span class="COMM">// Mimics xhr.readyState:</span><span class="WHIT">
<span class='linenumber'> 346</span> </span><span class="WHIT">        </span><span class="COMM">// 0 Uninitialized, 1 Loading, 2 Loaded, 3 Interactive, 4 Complete</span><span class="WHIT">
<span class='linenumber'> 347</span> </span><span class="WHIT">        </span><span class="NAME">readyState</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 348</span> 
<span class='linenumber'> 349</span> </span><span class="WHIT">        </span><span class="COMM">/** Mimics xhr.send(). 
<span class='linenumber'> 350</span>          * @inner */</span><span class="WHIT">
<span class='linenumber'> 351</span> </span><span class="WHIT">        </span><span class="NAME">send</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 352</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 353</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// open() was called successfully</span><span class="WHIT">
<span class='linenumber'> 354</span> 
<span class='linenumber'> 355</span> </span><span class="WHIT">            </span><span class="COMM">// Internal request ready, send request via script loading</span><span class="WHIT">
<span class='linenumber'> 356</span> </span><span class="WHIT">            </span><span class="NAME">ctx.req.ctx.setAttribute</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 357</span> </span><span class="WHIT">            </span><span class="NAME">ctx.req.load</span><span class="PUNC">(</span><span class="NAME">ctx.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx.release</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// called after responseProxy</span><span class="WHIT">
<span class='linenumber'> 358</span> 
<span class='linenumber'> 359</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// The request was successfully sent</span><span class="WHIT">
<span class='linenumber'> 360</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 361</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 362</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 363</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 364</span> 
<span class='linenumber'> 365</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 366</span>          * Uused to process successful responses or errors, and to call 
<span class='linenumber'> 367</span>          * client's &lt;code>callbackFn&lt;/code> function.
<span class='linenumber'> 368</span>          * &lt;p/>
<span class='linenumber'> 369</span>          * Mimics the behavior of the &lt;code>XMLHttpRequest&lt;/code>'s
<span class='linenumber'> 370</span>          * &lt;code>onreadystatechange&lt;/code> function in handling requests. 
<span class='linenumber'> 371</span>          * Accordingly, the XHR states are imitated by the 
<span class='linenumber'> 372</span>          * &lt;code>readyState&lt;/code> variable. 
<span class='linenumber'> 373</span>          * &lt;p/>
<span class='linenumber'> 374</span>          * If the &lt;code>_Response&lt;/code> instance is the &lt;code>value&lt;/code> of 
<span class='linenumber'> 375</span>          * the parameter, an error has occurred to the request. Otherwise, 
<span class='linenumber'> 376</span>          * the &lt;code>value&lt;/code> is the actual request sent from the server.
<span class='linenumber'> 377</span>          * &lt;p/>
<span class='linenumber'> 378</span>          * Note: client-aborted requests must not be handled here because 
<span class='linenumber'> 379</span>          * aborted request must not call the &lt;code>callbackFn&lt;/code>.
<span class='linenumber'> 380</span>          * @inner
<span class='linenumber'> 381</span>          * @param value {Object} Payload from the server or Error Response
<span class='linenumber'> 382</span>          */</span><span class="WHIT">
<span class='linenumber'> 383</span> </span><span class="WHIT">        </span><span class="NAME">responseProxy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 384</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 385</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 386</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Currently receiving data</span><span class="WHIT">
<span class='linenumber'> 387</span> 
<span class='linenumber'> 388</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 389</span> </span><span class="WHIT">              </span><span class="COMM">// Error initiated by the client: cannot abort script load</span><span class="WHIT">
<span class='linenumber'> 390</span> </span><span class="WHIT">              </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 391</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 392</span> </span><span class="WHIT">              </span><span class="COMM">// Successfully received response via Proxy (status: 200 - 299)</span><span class="WHIT">
<span class='linenumber'> 393</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isString</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 394</span> </span><span class="WHIT">                </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'OK'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'html/text'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 395</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 396</span> </span><span class="WHIT">                </span><span class="NAME">resp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">_Response</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'OK'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'application/json'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 397</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 398</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 399</span> </span><span class="WHIT">            </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 400</span> </span><span class="WHIT">            </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'status: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">resp.statusText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' ('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">that</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 401</span> 
<span class='linenumber'> 402</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.callbackFn</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 403</span> </span><span class="WHIT">              </span><span class="NAME">ctx.callbackFn</span><span class="PUNC">(</span><span class="NAME">resp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Client callback with native response              </span><span class="WHIT">
<span class='linenumber'> 404</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 405</span> 
<span class='linenumber'> 406</span> </span><span class="WHIT">            </span><span class="COMM">// Must not release req here because script loading cannot be </span><span class="WHIT">
<span class='linenumber'> 407</span> </span><span class="WHIT">            </span><span class="COMM">// canceled; the server will eventually execute this callback.</span><span class="WHIT">
<span class='linenumber'> 408</span> </span><span class="WHIT">            </span><span class="COMM">// Just stop any withstanding timeouts.</span><span class="WHIT">
<span class='linenumber'> 409</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 410</span> </span><span class="WHIT">              </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 411</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 412</span> </span><span class="WHIT">            </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_RECEIVED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 413</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 414</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 415</span> 
<span class='linenumber'> 416</span> </span><span class="WHIT">        </span><span class="COMM">/** Releases all of req's resources.
<span class='linenumber'> 417</span>          * @inner */</span><span class="WHIT">
<span class='linenumber'> 418</span> </span><span class="WHIT">        </span><span class="NAME">release</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 419</span> </span><span class="WHIT">          </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">that._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 420</span> </span><span class="WHIT">          </span><span class="NAME">ctx.req.unload</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 421</span> </span><span class="WHIT">          </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 422</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 423</span> 
<span class='linenumber'> 424</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='linenumber'> 425</span>          * Checks if the request context has timed out.
<span class='linenumber'> 426</span>          * @inner
<span class='linenumber'> 427</span>          * @param {Number} buff Extra buffer in Milliseconds before the timeout 
<span class='linenumber'> 428</span>          */</span><span class="WHIT">
<span class='linenumber'> 429</span> </span><span class="WHIT">        </span><span class="NAME">isTimedOut</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">buff</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 430</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ctx.timestamp</span><span class="WHIT">
<span class='linenumber'> 431</span> </span><span class="WHIT">              </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">buff</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">ctx.timeout</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 432</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 433</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="NAME">tau.mixin</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._opts</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 434</span> 
<span class='linenumber'> 435</span> </span><span class="WHIT">      </span><span class="COMM">// XSS is always async: register request ctx and setup timeout</span><span class="WHIT">
<span class='linenumber'> 436</span> </span><span class="WHIT">      </span><span class="NAME">that._registry</span><span class="PUNC">[</span><span class="NAME">ctx.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 437</span> </span><span class="WHIT">      </span><span class="NAME">ctx.timeoutId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_createTimeout</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 438</span> 
<span class='linenumber'> 439</span> </span><span class="WHIT">      </span><span class="COMM">// JSONP requests need callback parameters</span><span class="WHIT">
<span class='linenumber'> 440</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'JSONP'</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ctx.type.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 441</span> </span><span class="WHIT">        </span><span class="NAME">ctx.url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tau.url</span><span class="PUNC">(</span><span class="NAME">ctx.url</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendParam</span><span class="PUNC">(</span><span class="WHIT">
<span class='linenumber'> 442</span> </span><span class="WHIT">                    </span><span class="NAME">ctx.jsonpCallback</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'callback'</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='linenumber'> 443</span>                     </span><span class="NAME">ctx.jsonpNamespace</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'.'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'.responseProxy'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 444</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 445</span> </span><span class="WHIT">      </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_SENT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 446</span> 
<span class='linenumber'> 447</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 448</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 449</span> 
<span class='linenumber'> 450</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 451</span>      * 명시된 id를 이용하여 이전에 전송했던 Request를 중지시킨다. 내부적으로
<span class='linenumber'> 452</span>      * {@link tau.rt.Event.REQ_ABORTED}이벤트가 발생된다.
<span class='linenumber'> 453</span>      * @param {String} id Request
<span class='linenumber'> 454</span>      */</span><span class="WHIT">
<span class='linenumber'> 455</span> </span><span class="WHIT">    </span><span class="NAME">abort</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 456</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this._registry</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 457</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 458</span> </span><span class="WHIT">        </span><span class="NAME">tau.log.debug</span><span class="PUNC">(</span><span class="STRN">'aborted ('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ctx.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 459</span> </span><span class="WHIT">        </span><span class="NAME">ctx.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 460</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 461</span> </span><span class="WHIT">          </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">ctx.timeoutId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 462</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 463</span> </span><span class="WHIT">        </span><span class="NAME">_fireSysEvent</span><span class="PUNC">(</span><span class="NAME">tau.rt.Event.REQ_ABORTED</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 464</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 465</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 466</span> 
<span class='linenumber'> 467</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'> 468</span>      * 처리되지 않은 Request들을 Garbage collect한다.
<span class='linenumber'> 469</span>      * @param {Number} buff 추가적인 timeout
<span class='linenumber'> 470</span>      * buffer(milliseconds)
<span class='linenumber'> 471</span>      */</span><span class="WHIT">
<span class='linenumber'> 472</span> </span><span class="WHIT">    </span><span class="NAME">gc</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">buff</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 473</span> </span><span class="WHIT">      </span><span class="NAME">tau.forEach</span><span class="PUNC">(</span><span class="NAME">this._registry</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 474</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tau.isFunction</span><span class="PUNC">(</span><span class="NAME">ctx.isTimedOut</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ctx.isTimedOut</span><span class="PUNC">(</span><span class="NAME">buff</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 475</span> </span><span class="WHIT">          </span><span class="NAME">ctx.release</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 476</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 477</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 478</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 479</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 480</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 481</span> </span></pre></body></html>